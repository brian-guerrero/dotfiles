# ============================================
# GENERAL SETTINGS
# ============================================

# Position status bar at the top of the window
set-option -g status-position top

# Enable mouse support for pane selection, resizing, and scrolling
set -g mouse on

# Start window numbering at 1 instead of 0
set -g base-index 1
set -g pane-base-index 1

# ============================================
# STATUS BAR
# ============================================

# Carbon Fox pink theme with transparent background
set -g status-style bg=default,fg='#161616'

# Window list in center showing all windows
set -g status-justify centre
set -g window-status-format '#[fg=#525252] #I:#W '
set -g window-status-current-format '#[fg=#ff7eb6,bold] #I:#W '
set -g window-status-current-style fg='#ff7eb6',bold

# Left status: current session with rounded edges
set -g status-left '#[bg=#ff7eb6,fg=#0c0c0c,bold]  #S #[bg=default,fg=#ff7eb6]'
set -g status-left-length 50

# Right status: git info with rounded edges
set -g status-right '#[bg=default,fg=#ff7eb6]#[bg=#ff7eb6,fg=#0c0c0c] #(cd "#{pane_current_path}" && git rev-parse --short HEAD 2>/dev/null || echo "%H:%M")  '
set -g status-right-length 150

# ============================================
# PREFIX KEY CONFIGURATION
# ============================================

# Change prefix from default Ctrl-b to Ctrl-a (more ergonomic)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# ============================================
# COPY MODE
# ============================================

# Use Vim-style keybindings for copy mode navigation
setw -g mode-keys vi

# ============================================
# PANE NAVIGATION
# ============================================

# Navigate between panes using Vim-style hjkl keys (requires prefix)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# ============================================
# PANE SPLITTING
# ============================================

# Split panes using intuitive | (vertical) and - (horizontal)
bind | split-window -h
bind - split-window -v

# Remove default split keybindings
unbind '"'
unbind %

# ============================================
# PANE MANAGEMENT
# ============================================

# Close pane with x (switches to previous session if last pane)
bind x if-shell "[ $(tmux list-panes | wc -l) -eq 1 ]" "if-shell '[ $(tmux list-windows | wc -l) -gt 1 ]' 'kill-window' 'if-shell \"[ $(tmux list-sessions | wc -l) -gt 1 ]\" \"switch-client -p ; kill-session\" \"kill-session\"'" "kill-pane"

# ============================================
# WINDOW MANAGEMENT
# ============================================

# Create new window in the same directory as current pane
bind c new-window -c "#{pane_current_path}"

# ============================================
# WINDOW NAVIGATION
# ============================================

# Navigate between windows using Alt+h/l (no prefix required)
bind -n M-h previous-window
bind -n M-l next-window

# ============================================
# SESSION MANAGEMENT
# ============================================

# Remove default clock keybinding
unbind t

# Create new session with t (opens popup to name session)
bind t command-prompt -p "New session name:" "new-session -s '%%'"

# Rename current session with R (uppercase)
bind R command-prompt "rename-session %%"

# Session selector popup with Tab key
bind Tab display-popup -E "\
    tmux list-sessions -F '#{session_name}' | \
    fzf --reverse --header 'Select Session' | \
    xargs tmux switch-client -t"

# ============================================
# CONFIGURATION
# ============================================

# Reload tmux configuration file with prefix + r
bind r source-file ~/.tmux.conf \; display "Config reloaded!"